<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<title></title>
</head>
<body>

<script type="text/javascript" src="point.js"></script>

<script type="text/javascript">
var js = new PointJS('2d', 1000 , 550, {backgroundColor: '#555'});
var game = js.game;
var system = js.system;
var log = system.log;
system.initFullPage();

var random = js.math.random;
var randomColor = js.colors.randomColor;

var mouse_control = js.mouseControl;
mouse_control.initMouseControl();

var proto_c = game.newCircleObject({
    radius: 15, fillColor: 'blue',
    strokeColor: 'black', strokeWidth: 2
});

var map_size = 100, part_size = 30,
    fon = [];
{
    for (var x = 0; x < map_size; x++)
        for  (var y = 0; y < map_size; y++){
            fon.push(game.newRectObject({
                 x: x*part_size, y: y*part_size,
                 w: part_size - 2, h: part_size - 2,
                 fillColor: '#999'
            }))
        }
}

var food_count = 1500;
var food = [];
{
    for (var x = 0; x < food_count; x++)
        food.push(game.newCircleObject({
            x: random(0, map_size*part_size-16), y: random(0, map_size*part_size-16),
            radius: random(3, 8),
            fillColor: randomColor(0, 255)
        }))
}
////////////////////////////////
game.newLoop('game',function() {

    proto_c.moveTimeC(mouse_control.getPosition(), proto_c.radius*2+20);

    js.camera.setPositionC(proto_c.getPosition(1));


////////////////
    game.clear();
    for (var i in fon) {
        if (fon[i].isInCamera()) {
            fon[i].draw();
        }
    }

    for (var b in food){
        if (food[b].isInCamera()) {
            if (food[b].getDistanceC(proto_c.getPositionC()) < proto_c.radius*1.5 + 20) {
                if (proto_c.radius > food[b].radius)
                    food[b].moveTimeC(proto_c.getPosition(1), food[b].radius*5 + 20);
                else proto_c.moveTimeC(food[b].getPosition(1), proto_c.radius*5 + 20);
            }

            if (proto_c.isDynamicIntersect(food[b].getDynamicBox())) {
                if (proto_c.radius<255)
                    proto_c.scaleC(1+ food[b].radius*0.01/proto_c.radius);
                food.splice(b, 1);
            }

            if (food.length < 1500)
                food.push(game.newCircleObject({
                    x: random(0, map_size * part_size - 16), y: random(0, map_size * part_size - 16),
                    radius: random(3, 10),
                    fillColor: randomColor(0, 255)
                }));

            food[b].draw();
        }
    }

    proto_c.draw();
});

game.setLoop('game');
game.start();





</script>


</body>
</html>
